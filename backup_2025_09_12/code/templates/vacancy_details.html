{% extends "base.html" %}

{% block title %}{{ vacancy.title }} - Карьера в InBack{% endblock %}

{% block meta %}
<meta name="description" content="{{ vacancy.meta_description or (vacancy.description[:160] + '...' if vacancy.description|length > 160 else vacancy.description) }}">
<meta name="keywords" content="работа краснодар, вакансия {{ vacancy.department|lower }}, {{ vacancy.title|lower }}, карьера недвижимость">

<!-- Open Graph -->
<meta property="og:title" content="{{ vacancy.title }} - Карьера в InBack">
<meta property="og:description" content="{{ vacancy.description[:200] }}">
<meta property="og:type" content="article">
<meta property="og:url" content="{{ request.url }}">

<!-- Schema.org -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "JobPosting",
  "title": "{{ vacancy.title }}",
  "description": "{{ vacancy.description }}",
  "hiringOrganization": {
    "@type": "Organization",
    "name": "InBack",
    "sameAs": "https://inback.ru"
  },
  "jobLocation": {
    "@type": "Place",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "{{ vacancy.location }}",
      "addressCountry": "RU"
    }
  },
  "employmentType": "{{ vacancy.employment_type }}",
  "experienceRequirements": "{{ vacancy.experience_level }}",
  {% if vacancy.salary_min or vacancy.salary_max %}
  "baseSalary": {
    "@type": "MonetaryAmount",
    "currency": "RUB",
    {% if vacancy.salary_min and vacancy.salary_max %}
    "value": {
      "@type": "QuantitativeValue",
      "minValue": {{ vacancy.salary_min }},
      "maxValue": {{ vacancy.salary_max }},
      "unitText": "MONTH"
    }
    {% elif vacancy.salary_min %}
    "value": {{ vacancy.salary_min }}
    {% elif vacancy.salary_max %}
    "value": {{ vacancy.salary_max }}
    {% endif %}
  },
  {% endif %}
  "datePosted": "{{ vacancy.posted_at.strftime('%Y-%m-%d') }}",
  {% if vacancy.application_deadline %}
  "validThrough": "{{ vacancy.application_deadline.strftime('%Y-%m-%d') }}",
  {% endif %}
  "workFromHome": {{ 'true' if vacancy.is_remote else 'false' }}
}
</script>
{% endblock %}

{% block content %}
<!-- Loading Animation -->
<div class="loading-animation bg-gradient-to-b from-[#006699] to-[#0088CC]">
    <div class="relative w-32 h-32">
        <div class="absolute inset-0 rounded-full border-[10px] border-white/20 animate-ping"></div>
        <div class="absolute inset-[15px] rounded-full border-[10px] border-white/30 animate-ping animation-delay-200"></div>
        <div class="absolute inset-[30px] rounded-full border-[10px] border-white/40 animate-ping animation-delay-400"></div>
        <div class="absolute inset-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-16 rounded-full bg-white flex items-center justify-center">
            <div class="w-8 h-8 rounded-full gradient-bg"></div>
        </div>
    </div>
    <div class="mt-8 text-white text-xl font-semibold">Загружаем детали вакансии...</div>
</div>

<!-- Breadcrumbs -->
<div class="container mx-auto px-4 py-4">
    <nav aria-label="Breadcrumb" class="flex">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a class="text-[#0088CC] hover:text-gray-700 inline-flex items-center" href="{{ url_for('index') }}">
                    <i class="fas fa-home mr-2"></i>
                    Главная
                </a>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                    <a href="{{ url_for('careers') }}" class="text-[#0088CC] hover:text-gray-700">Карьера</a>
                </div>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                    <span class="text-gray-500">{{ vacancy.title }}</span>
                </div>
            </li>
        </ol>
    </nav>
</div>

<!-- Vacancy Details -->
<section class="py-8 bg-gradient-to-b from-white to-gray-50">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-xl p-8 shadow-sm mb-8">
                <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-4">
                            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">{{ vacancy.title }}</h1>
                            {% if vacancy.is_urgent %}
                                <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">
                                    <i class="fas fa-exclamation-triangle mr-1"></i>Срочно
                                </span>
                            {% endif %}
                            {% if vacancy.is_featured %}
                                <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium">
                                    <i class="fas fa-star mr-1"></i>Топ
                                </span>
                            {% endif %}
                        </div>
                        
                        <div class="flex flex-wrap gap-3 mb-6">
                            <span class="flex items-center px-4 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm font-medium">
                                <i class="fas fa-building mr-2"></i>{{ vacancy.department }}
                            </span>
                            <span class="flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium">
                                <i class="fas fa-map-marker-alt mr-2"></i>{{ vacancy.location }}
                            </span>
                            <span class="flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium">
                                <i class="fas fa-clock mr-2"></i>{{ vacancy.employment_type }}
                            </span>
                            <span class="flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium">
                                <i class="fas fa-user-graduate mr-2"></i>{{ vacancy.experience_level }}
                            </span>
                            {% if vacancy.is_remote %}
                            <span class="flex items-center px-4 py-2 bg-green-100 text-green-700 rounded-lg text-sm font-medium">
                                <i class="fas fa-home mr-2"></i>Удаленная работа
                            </span>
                            {% endif %}
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center text-gray-500 text-sm">
                                <i class="fas fa-calendar mr-2"></i>
                                Опубликовано {{ vacancy.posted_at.strftime('%d.%m.%Y') }}
                                <span class="mx-2">•</span>
                                <i class="fas fa-eye mr-1"></i>{{ vacancy.views_count }} просмотров
                            </div>
                            {% if vacancy.application_deadline %}
                            <div class="text-sm text-orange-600 font-medium">
                                <i class="fas fa-clock mr-1"></i>
                                Подача заявок до {{ vacancy.application_deadline.strftime('%d.%m.%Y') }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="lg:ml-8 mt-6 lg:mt-0 flex-shrink-0">
                        <div class="bg-gradient-to-r from-[#0088CC] to-[#006699] p-6 rounded-xl text-white text-center">
                            <div class="text-2xl font-bold mb-2">{{ vacancy.formatted_salary() }}</div>
                            <button onclick="openApplicationModal()" 
                                    class="w-full px-6 py-3 bg-white text-[#0088CC] font-semibold rounded-lg hover:bg-gray-100 transition-all duration-200 transform hover:scale-[1.02]">
                                <i class="fas fa-paper-plane mr-2"></i>
                                Откликнуться
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Content -->
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Main Content -->
                <div class="lg:col-span-2 space-y-8">
                    <!-- Description -->
                    <div class="bg-white rounded-xl p-8 shadow-sm">
                        <h2 class="text-2xl font-bold mb-6 text-gray-900">О вакансии</h2>
                        <div class="prose prose-lg max-w-none text-gray-700">
                            {{ vacancy.description | replace('\n', '<br>') | safe }}
                        </div>
                    </div>
                    
                    <!-- Responsibilities -->
                    <div class="bg-white rounded-xl p-8 shadow-sm">
                        <h2 class="text-2xl font-bold mb-6 text-gray-900">
                            <i class="fas fa-tasks mr-3 text-[#0088CC]"></i>
                            Обязанности
                        </h2>
                        <div class="prose prose-lg max-w-none text-gray-700">
                            {{ vacancy.responsibilities | replace('\n', '<br>') | safe }}
                        </div>
                    </div>
                    
                    <!-- Requirements -->
                    <div class="bg-white rounded-xl p-8 shadow-sm">
                        <h2 class="text-2xl font-bold mb-6 text-gray-900">
                            <i class="fas fa-check-circle mr-3 text-[#0088CC]"></i>
                            Требования
                        </h2>
                        <div class="prose prose-lg max-w-none text-gray-700">
                            {{ vacancy.requirements | replace('\n', '<br>') | safe }}
                        </div>
                    </div>
                    
                    <!-- Benefits -->
                    {% if vacancy.benefits %}
                    <div class="bg-white rounded-xl p-8 shadow-sm">
                        <h2 class="text-2xl font-bold mb-6 text-gray-900">
                            <i class="fas fa-gift mr-3 text-[#0088CC]"></i>
                            Условия и льготы
                        </h2>
                        <div class="prose prose-lg max-w-none text-gray-700">
                            {{ vacancy.benefits | replace('\n', '<br>') | safe }}
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Contact Info -->
                    <div class="bg-white rounded-xl p-6 shadow-sm">
                        <h3 class="text-xl font-bold mb-4 text-gray-900">Контакты</h3>
                        <div class="space-y-3">
                            {% if vacancy.contact_email %}
                            <div class="flex items-center">
                                <i class="fas fa-envelope text-[#0088CC] w-5 mr-3"></i>
                                <a href="mailto:{{ vacancy.contact_email }}" class="text-[#0088CC] hover:underline">
                                    {{ vacancy.contact_email }}
                                </a>
                            </div>
                            {% endif %}
                            {% if vacancy.contact_phone %}
                            <div class="flex items-center">
                                <i class="fas fa-phone text-[#0088CC] w-5 mr-3"></i>
                                <a href="tel:{{ vacancy.contact_phone }}" class="text-[#0088CC] hover:underline">
                                    {{ vacancy.contact_phone }}
                                </a>
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <button onclick="openApplicationModal()" 
                                    class="w-full px-6 py-3 bg-gradient-to-r from-[#0088CC] to-[#006699] text-white font-semibold rounded-lg hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02]">
                                <i class="fas fa-paper-plane mr-2"></i>
                                Отправить резюме
                            </button>
                        </div>
                    </div>
                    
                    <!-- Share -->
                    <div class="bg-white rounded-xl p-6 shadow-sm">
                        <h3 class="text-xl font-bold mb-4 text-gray-900">Поделиться</h3>
                        <div class="flex space-x-3">
                            <a href="https://t.me/share/url?url={{ request.url }}&text={{ vacancy.title }}" target="_blank"
                               class="flex-1 px-4 py-3 bg-blue-500 text-white rounded-lg text-center hover:bg-blue-600 transition-all">
                                <i class="fab fa-telegram"></i>
                            </a>
                            <a href="https://vk.com/share.php?url={{ request.url }}&title={{ vacancy.title }}" target="_blank"
                               class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg text-center hover:bg-blue-700 transition-all">
                                <i class="fab fa-vk"></i>
                            </a>
                            <a href="https://api.whatsapp.com/send?text={{ vacancy.title }} {{ request.url }}" target="_blank"
                               class="flex-1 px-4 py-3 bg-green-500 text-white rounded-lg text-center hover:bg-green-600 transition-all">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Back to Careers -->
                    <div class="bg-gray-50 rounded-xl p-6">
                        <a href="{{ url_for('careers') }}" 
                           class="flex items-center justify-center px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-white hover:border-[#0088CC] hover:text-[#0088CC] transition-all duration-200">
                            <i class="fas fa-arrow-left mr-2"></i>
                            Все вакансии
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Related Vacancies -->
            {% if related_vacancies %}
            <div class="mt-16">
                <h2 class="text-2xl font-bold mb-8 text-gray-900">Похожие вакансии в отделе "{{ vacancy.department }}"</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    {% for related in related_vacancies %}
                    <div class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-all">
                        <h3 class="text-lg font-bold mb-2 text-gray-900">{{ related.title }}</h3>
                        <div class="flex items-center gap-2 mb-3">
                            <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs">{{ related.employment_type }}</span>
                            <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs">{{ related.experience_level }}</span>
                        </div>
                        <p class="text-gray-600 text-sm mb-4">{{ related.description[:100] }}...</p>
                        <div class="flex justify-between items-center">
                            <div class="text-[#0088CC] font-semibold">{{ related.formatted_salary() }}</div>
                            <a href="{{ url_for('vacancy_details', vacancy_id=related.id) }}" 
                               class="px-4 py-2 bg-[#0088CC] text-white rounded hover:bg-[#006699] transition-all text-sm">
                                Подробнее
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}